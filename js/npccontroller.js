var a44_0x8c83=['inventory','putInventory','CANT\x20GET\x20ITEM','itemDespawn','packetHandler','handlePartyInvite','./message','./utils','../shared/js/itemtypes','exports','world','map','entities','onRequestPath','findPath','pushBroadcast','getLastMove','handleEntityGroupMembership','info','npc.onDeath\x20-\x20Resssed\x20YeahhH!!!!','isDead','enterCallback','removeTarget','forceStop','state','Roaming','resetHitPoints','attackers','Spawn','npcplayers','name','npc-state:','isStunned','target','isMoving','party','leader','PlayerState','Moving','followAndAggro','getCharactersAround','level','influence','index','aggroEntity','engage','path','followingTimer','now','Aggro','createAttackLink','follow','worldServer','hasTarget','Hurting','canAttack','isAdjacentNonDiagonal','canMove','getDoor','minLevel','maxLevel','removeNpcPlayer','maps','addNpcPlayer','npcController','setEntityStep','isAttacked','isOver','Follow','HurtingToRoaming','dmg','criticalHit','hitPoints','handleHurtEntity','forEachAttacker','GettingItems','handleLoot','canRoam','getRandomPosition','length','isItem','kind','count','skillKind','skillLevel'];(function(_0x2e06ed,_0x96bf3a){var _0x3372c7=function(_0x3a45ad){while(--_0x3a45ad){_0x2e06ed['push'](_0x2e06ed['shift']());}};_0x3372c7(++_0x96bf3a);}(a44_0x8c83,0x15a));var a44_0x2515=function(_0x45cbea,_0x106a5d){_0x45cbea=_0x45cbea-0x0;var _0x561b2f=a44_0x8c83[_0x45cbea];return _0x561b2f;};var Messages=require(a44_0x2515('0x0')),_=require('underscore'),Utils=require(a44_0x2515('0x1')),ItemTypes=require(a44_0x2515('0x2')),Formulas=require('./formulas');module[a44_0x2515('0x3')]=NpcController=Class['extend']({'init':function(_0x298ca7,_0x21151f){this[a44_0x2515('0x4')]=this['worldServer']=_0x298ca7;this[a44_0x2515('0x5')]=_0x21151f;},'NpcOnStep':function(_0x347c30,_0x1cdc5d,_0x5b40f7){},'onNpcMoveCallback':function(_0x4fe984){},'setEntityStep':function(){var _0x2d9ec9=this;var _0x51f4a0=null;for(var _0x2378d2 in _0x2d9ec9[a44_0x2515('0x5')][a44_0x2515('0x6')]['npcplayers']){_0x51f4a0=_0x2d9ec9['map'][a44_0x2515('0x6')]['npcplayers'][_0x2378d2];_0x51f4a0['onStartPathing'](function(_0x2c5061,_0x58e73a){var _0x2ce630=this;});_0x51f4a0[a44_0x2515('0x7')](function(_0x374b06,_0x32e49d){var _0x203532=this;if(_0x203532['x']==_0x374b06&&_0x203532['y']==_0x32e49d)return null;var _0x17d046=[];var _0x2c7086=_0x2d9ec9[a44_0x2515('0x5')][a44_0x2515('0x6')][a44_0x2515('0x8')](_0x203532,_0x374b06,_0x32e49d,_0x17d046);if(_0x2c7086){_0x2d9ec9[a44_0x2515('0x5')][a44_0x2515('0x6')][a44_0x2515('0x9')](_0x203532[a44_0x2515('0xa')](_0x203532));}return _0x2c7086;});_0x51f4a0['onStopPathing'](function(_0x5ef044,_0x3d3df4){var _0x353adc=this;_0x2d9ec9['map']['entities'][a44_0x2515('0xb')](_0x353adc);});_0x51f4a0['onDeath'](function(){log[a44_0x2515('0xc')](a44_0x2515('0xd'));var _0x5bf5dc=this;setTimeout(function(){_0x5bf5dc[a44_0x2515('0xe')]=![];var _0xf327d6=_0x2d9ec9[a44_0x2515('0x5')][a44_0x2515('0xf')](_0x5bf5dc);_0x5bf5dc['x']=_0xf327d6['x'];_0x5bf5dc['y']=_0xf327d6['y'];_0x5bf5dc[a44_0x2515('0x10')]();_0x5bf5dc[a44_0x2515('0x11')]();_0x5bf5dc[a44_0x2515('0x12')]=Types['PlayerState'][a44_0x2515('0x13')];_0x5bf5dc[a44_0x2515('0x14')](_0x5bf5dc['maxHitPoints']);_0x5bf5dc[a44_0x2515('0x15')]={};_0x2d9ec9['map'][a44_0x2515('0x6')][a44_0x2515('0x9')](new Messages[(a44_0x2515('0x16'))](_0x5bf5dc));},0x2710);});}},'checkDebug':function(){var _0x3b70fa=this;for(var _0x508b32 in _0x3b70fa[a44_0x2515('0x5')][a44_0x2515('0x6')][a44_0x2515('0x17')]){var _0x53eea2=_0x3b70fa[a44_0x2515('0x5')][a44_0x2515('0x6')]['npcplayers'][_0x508b32];log[a44_0x2515('0xc')]('npc-name:'+_0x53eea2[a44_0x2515('0x18')]);log['info'](a44_0x2515('0x19')+_0x53eea2['state']);}},'checkAggro':function(){var _0x204b9d=this;for(var _0x2b1276 in _0x204b9d[a44_0x2515('0x5')][a44_0x2515('0x6')]['npcplayers']){var _0x22da81=_0x204b9d['map'][a44_0x2515('0x6')][a44_0x2515('0x17')][_0x2b1276];if(_0x22da81[a44_0x2515('0xe')]||_0x22da81[a44_0x2515('0x1a')]||_0x22da81[a44_0x2515('0x1b')]||_0x22da81[a44_0x2515('0x1c')]())continue;if(_0x22da81[a44_0x2515('0x1d')]&&_0x22da81[a44_0x2515('0x1d')][a44_0x2515('0x1e')][a44_0x2515('0x1b')]&&_0x22da81['state']==Types[a44_0x2515('0x1f')][a44_0x2515('0x20')]){_0x204b9d[a44_0x2515('0x21')](_0x22da81,_0x22da81[a44_0x2515('0x1d')]['leader'][a44_0x2515('0x1b')]);continue;}if(_0x22da81[a44_0x2515('0x12')]==Types[a44_0x2515('0x1f')]['Moving']){var _0xc1f867=![];var _0x371ef5=_0x204b9d[a44_0x2515('0x5')][a44_0x2515('0x6')][a44_0x2515('0x22')](_0x22da81,0xa);for(var _0x27295e in _0x371ef5){var _0x73814b=_0x371ef5[_0x27295e];if(_0x73814b instanceof Mob&&!_0x73814b[a44_0x2515('0xe')]&&_0x73814b[a44_0x2515('0x23')]-0x5<=_0x22da81[a44_0x2515('0x23')]||_0x73814b instanceof Player&&_0x22da81[a44_0x2515('0x24')][_0x73814b['id']]&&_0x22da81['influence'][_0x73814b['id']]<0x0&&_0x73814b[a44_0x2515('0x23')]<=_0x22da81[a44_0x2515('0x23')]&&_0x22da81[a44_0x2515('0x23')]>=0x14&&_0x204b9d[a44_0x2515('0x5')][a44_0x2515('0x25')]!=0x0){_0xc1f867=!![];_0x204b9d[a44_0x2515('0x21')](_0x22da81,_0x73814b);break;}}if(!_0xc1f867&&!_0x22da81[a44_0x2515('0x1c')]()){_0x22da81[a44_0x2515('0x11')]();_0x22da81[a44_0x2515('0x12')]=Types[a44_0x2515('0x1f')][a44_0x2515('0x13')];}}}},'followAndAggro':function(_0x137d89,_0x41c71c){var _0xea64e=this;_0x137d89[a44_0x2515('0x11')]();_0xea64e[a44_0x2515('0x26')](_0x137d89,_0x41c71c);_0x137d89[a44_0x2515('0x27')](_0x41c71c);_0x137d89['follow'](_0x41c71c);if(!_0x137d89['path']){_0x137d89[a44_0x2515('0x10')]();_0x137d89[a44_0x2515('0x12')]=Types[a44_0x2515('0x1f')][a44_0x2515('0x13')];return;}if(_0x137d89[a44_0x2515('0x12')]==Types[a44_0x2515('0x1f')][a44_0x2515('0x20')]){var _0x4d889a=_0x137d89[a44_0x2515('0x28')]?_0x137d89[a44_0x2515('0x28')]['length']:0x1;_0x137d89[a44_0x2515('0x29')]=new Timer(_0x4d889a*0x190,Date[a44_0x2515('0x2a')]());_0x137d89[a44_0x2515('0x12')]=Types[a44_0x2515('0x1f')][a44_0x2515('0x2b')];}},'aggroEntity':function(_0x5efa64,_0x16bd72){this['world'][a44_0x2515('0x2c')](_0x5efa64,_0x16bd72);_0x5efa64['engage'](_0x16bd72);_0x5efa64[a44_0x2515('0x2d')](_0x16bd72);},'checkHit':function(){var _0x143ac9=new Date()['getTime']();var _0x3d67b9=this[a44_0x2515('0x2e')];var _0x41e9f0=this;for(var _0xb7cf85 in _0x41e9f0[a44_0x2515('0x5')][a44_0x2515('0x6')]['npcplayers']){var _0x17837f=_0x41e9f0['map'][a44_0x2515('0x6')][a44_0x2515('0x17')][_0xb7cf85];if(_0x17837f[a44_0x2515('0xe')]||_0x17837f['isStunned']||!_0x17837f[a44_0x2515('0x2f')]()||_0x17837f[a44_0x2515('0x1b')][a44_0x2515('0xe')]||_0x17837f['hasNextStep']())continue;if(_0x17837f[a44_0x2515('0x12')]==Types['PlayerState'][a44_0x2515('0x30')]){if(_0x17837f[a44_0x2515('0x31')](_0x143ac9)&&_0x17837f[a44_0x2515('0x32')](_0x17837f[a44_0x2515('0x1b')])){_0x41e9f0['handleHurt'](_0x17837f);}}}},'checkStep':function(){var _0x25fb68=this;var _0x4bdf2b=Date[a44_0x2515('0x2a')]();var _0x2c58b0;for(var _0xc9701d in _0x25fb68[a44_0x2515('0x5')]['entities'][a44_0x2515('0x17')]){_0x2c58b0=_0x25fb68[a44_0x2515('0x5')][a44_0x2515('0x6')][a44_0x2515('0x17')][_0xc9701d];if(_0x2c58b0[a44_0x2515('0xe')])continue;if(_0x2c58b0[a44_0x2515('0x33')](_0x4bdf2b)){if(!_0x2c58b0['nextStep']()&&_0x2c58b0[a44_0x2515('0x12')]==Types[a44_0x2515('0x1f')][a44_0x2515('0x20')]){_0x2c58b0['state']=Types[a44_0x2515('0x1f')][a44_0x2515('0x13')];}var _0x109029=_0x25fb68[a44_0x2515('0x5')][a44_0x2515('0x34')](_0x2c58b0);if(_0x109029&&_0x109029['map']){if(_0x109029[a44_0x2515('0x35')]&&_0x2c58b0[a44_0x2515('0x23')]>=_0x109029[a44_0x2515('0x35')]&&_0x109029[a44_0x2515('0x36')]&&_0x2c58b0[a44_0x2515('0x23')]<_0x109029[a44_0x2515('0x36')]){_0x2c58b0[a44_0x2515('0x5')]['entities'][a44_0x2515('0x37')](_0x2c58b0);_0x2c58b0[a44_0x2515('0x5')]=_0x25fb68[a44_0x2515('0x4')][a44_0x2515('0x38')][_0x109029[a44_0x2515('0x5')]];_0x2c58b0[a44_0x2515('0x5')][a44_0x2515('0x6')][a44_0x2515('0x39')](_0x2c58b0);var _0x33f51f=_0x25fb68['map'][a44_0x2515('0xf')](_0x2c58b0);_0x2c58b0['setPosition'](_0x33f51f['x'],_0x33f51f['y']);_0x2c58b0['map'][a44_0x2515('0x3a')][a44_0x2515('0x3b')]();}}}if(_0x2c58b0[a44_0x2515('0x3c')]()){for(var _0x357d21 in _0x2c58b0['attackers']){var _0x464893=_0x2c58b0[a44_0x2515('0x15')][_0x357d21];if(!_0x2c58b0[a44_0x2515('0x24')][_0x464893['id']])_0x2c58b0['influence'][_0x464893['id']]=-0x1;else _0x2c58b0[a44_0x2515('0x24')][_0x464893['id']]--;_0x25fb68[a44_0x2515('0x26')](_0x2c58b0,_0x464893);_0x2c58b0[a44_0x2515('0x12')]=Types[a44_0x2515('0x1f')]['Following'];if(_0x2c58b0['isAdjacentNonDiagonal'](_0x464893)){_0x2c58b0[a44_0x2515('0x12')]=Types[a44_0x2515('0x1f')]['Hurting'];}continue;}}}},'checkMove':function(){var _0x217432=this;var _0x3af8f0=Date['now']();for(var _0x7545cc in _0x217432['map'][a44_0x2515('0x6')][a44_0x2515('0x17')]){var _0x20a268=_0x217432[a44_0x2515('0x5')]['entities'][a44_0x2515('0x17')][_0x7545cc];if(_0x20a268['isMoving']())continue;if(_0x20a268[a44_0x2515('0xe')]){continue;}if(_0x20a268[a44_0x2515('0x1b')]&&_0x20a268['target'][a44_0x2515('0xe')]){_0x20a268[a44_0x2515('0x10')]();_0x20a268['forceStop']();_0x20a268[a44_0x2515('0x12')]=Types[a44_0x2515('0x1f')][a44_0x2515('0x13')];continue;}if(_0x20a268[a44_0x2515('0x12')]==Types['PlayerState']['Aggro']){if(_0x20a268[a44_0x2515('0x29')]){if(_0x20a268['followingTimer'][a44_0x2515('0x3d')](_0x3af8f0)){_0x20a268[a44_0x2515('0x12')]=Types['PlayerState'][a44_0x2515('0x30')];}}continue;}if((_0x20a268['state']==Types['PlayerState'][a44_0x2515('0x3e')]||_0x20a268['state']==Types['PlayerState'][a44_0x2515('0x2b')])&&_0x20a268['target']){_0x217432['followAndAggro'](_0x20a268,_0x20a268[a44_0x2515('0x1b')]);}}},'handleHurt':function(_0x2f7c0a){var _0x2d0515=this;var _0x4ee07e=this['worldServer'];if(_0x2f7c0a['state']==Types['PlayerState'][a44_0x2515('0x30')]){if(_0x2f7c0a[a44_0x2515('0x1b')]===null||_0x2f7c0a['target'][a44_0x2515('0xe')]===!![]){_0x2d0515[a44_0x2515('0x3f')](_0x2f7c0a,![],_0x38b73d,_0x4b2a82);return;}if(_0x2f7c0a[a44_0x2515('0x1b')]&&_0x2f7c0a[a44_0x2515('0x32')](_0x2f7c0a[a44_0x2515('0x1b')])&&!_0x2f7c0a[a44_0x2515('0x1b')][a44_0x2515('0xe')]&&!_0x2f7c0a[a44_0x2515('0x1c')]()&&!_0x2f7c0a[a44_0x2515('0x1b')][a44_0x2515('0x1c')]()){var _0x1b9734=Formulas[a44_0x2515('0x40')](_0x2f7c0a,_0x2f7c0a['target']);if(_0x2f7c0a[a44_0x2515('0x41')]){_0x1b9734*=0x2;_0x2f7c0a[a44_0x2515('0x41')]=![];}_0x2f7c0a['target'][a44_0x2515('0x42')]-=_0x1b9734;if(_0x2f7c0a['target']['hitPoints']<=0x0)_0x2f7c0a[a44_0x2515('0x1b')][a44_0x2515('0xe')]=!![];var _0x38b73d=_0x2f7c0a['target']['x'],_0x4b2a82=_0x2f7c0a['target']['y'];if(_0x2f7c0a[a44_0x2515('0x1b')]instanceof Mob)_0x4ee07e['handleMobHate'](_0x2f7c0a[a44_0x2515('0x5')],_0x2f7c0a['target']['id'],_0x2f7c0a['id'],_0x1b9734);_0x4ee07e[a44_0x2515('0x43')](_0x2f7c0a['target'],_0x2f7c0a,_0x1b9734,_0x2f7c0a[a44_0x2515('0x41')]);if(!_0x2f7c0a['target']||_0x2f7c0a[a44_0x2515('0x1b')][a44_0x2515('0xe')]===!![]){_0x2d0515[a44_0x2515('0x3f')](_0x2f7c0a,!![],_0x38b73d,_0x4b2a82);return;}}else _0x2d0515[a44_0x2515('0x21')](_0x2f7c0a,_0x2f7c0a['target']);}},'HurtingToRoaming':function(_0x471088,_0x4abc1a,_0x57833b,_0x44a054){var _0x693805=this;if(_0x471088[a44_0x2515('0x1b')]){_0x471088['target'][a44_0x2515('0x44')](function(_0x2a3b4e){_0x2a3b4e['removeTarget']();if(_0x2a3b4e!=_0x471088){_0x2a3b4e[a44_0x2515('0x11')]();_0x2a3b4e['state']=Types['PlayerState'][a44_0x2515('0x13')];}});}if(_0x4abc1a){_0x471088[a44_0x2515('0x12')]=Types[a44_0x2515('0x1f')][a44_0x2515('0x45')];_0x471088['go'](_0x57833b,_0x44a054);setTimeout(function(){_0x693805[a44_0x2515('0x46')](_0x693805,_0x471088);},0x5dc);setTimeout(function(){_0x471088['state']=Types[a44_0x2515('0x1f')][a44_0x2515('0x13')];},0xbb8);}else _0x471088[a44_0x2515('0x12')]=Types[a44_0x2515('0x1f')]['Roaming'];},'Roaming':function(){var _0x47dca8=this;var _0x3fa9e0;for(var _0x396fd1 in _0x47dca8['map'][a44_0x2515('0x6')][a44_0x2515('0x17')]){_0x3fa9e0=_0x47dca8['map'][a44_0x2515('0x6')]['npcplayers'][_0x396fd1];if(_0x3fa9e0[a44_0x2515('0x1d')]&&_0x3fa9e0[a44_0x2515('0x12')]==Types[a44_0x2515('0x1f')][a44_0x2515('0x13')]&&_0x3fa9e0[a44_0x2515('0x1d')]['leader'][a44_0x2515('0x1c')]()){_0x3fa9e0['follow'](_0x3fa9e0[a44_0x2515('0x1d')]['leader']);if(_0x3fa9e0[a44_0x2515('0x28')]){_0x3fa9e0[a44_0x2515('0x12')]=Types[a44_0x2515('0x1f')]['Moving'];continue;}}if(_0x3fa9e0[a44_0x2515('0x12')]==Types['PlayerState'][a44_0x2515('0x13')]&&!_0x3fa9e0[a44_0x2515('0x1c')]()&&_0x3fa9e0[a44_0x2515('0x47')](Date['now']())){count=0x0;while(count++<0x5){var _0x1ca435=_0x47dca8['map'][a44_0x2515('0x6')][a44_0x2515('0x48')](_0x3fa9e0,0x5);if(_0x1ca435){_0x3fa9e0['go'](_0x1ca435['x'],_0x1ca435['y']);if(_0x3fa9e0['path']&&_0x3fa9e0[a44_0x2515('0x28')]['length']<=0xa){_0x3fa9e0['setRoamRate'](_0x3fa9e0['path'][a44_0x2515('0x49')]*0x2bc);_0x3fa9e0[a44_0x2515('0x12')]=Types[a44_0x2515('0x1f')]['Moving'];break;}}}}}},'handleLoot':function(_0x3020d5,_0x23d920){var _0x57e8db=_0x3020d5[a44_0x2515('0x5')][a44_0x2515('0x6')]['getEntitiesByPosition'](_0x23d920['x'],_0x23d920['y']);var _0x55a7d0;var _0x26e434=[];for(var _0x3e826c in _0x57e8db){_0x55a7d0=_0x57e8db[_0x3e826c];if(ItemTypes[a44_0x2515('0x4a')](_0x55a7d0[a44_0x2515('0x4b')])){var _0x1ea251=_0x55a7d0;log[a44_0x2515('0xc')]('item:'+_0x1ea251[a44_0x2515('0x4b')]+','+_0x1ea251[a44_0x2515('0x4c')]+','+_0x1ea251[a44_0x2515('0x4d')]+','+_0x1ea251[a44_0x2515('0x4e')]);var _0x3e826c=_0x23d920[a44_0x2515('0x4f')][a44_0x2515('0x50')](_0x1ea251[a44_0x2515('0x4b')],_0x1ea251[a44_0x2515('0x4c')],_0x1ea251[a44_0x2515('0x4d')],_0x1ea251['skillLevel']);if(_0x3e826c>=0x0){_0x23d920['checkItemEquip'](_0x3e826c);}else log[a44_0x2515('0xc')](a44_0x2515('0x51'));_0x3020d5[a44_0x2515('0x5')][a44_0x2515('0x6')][a44_0x2515('0x52')](_0x55a7d0);}}},'partyInvite':function(_0x2272fe,_0x24a6f9){if(_0x2272fe[a44_0x2515('0x24')][_0x24a6f9['id']]>=0x0)_0x24a6f9['packetHandler']['handlePartyInvite']([null,_0x2272fe['id'],0x1]);else _0x24a6f9[a44_0x2515('0x53')][a44_0x2515('0x54')]([null,_0x2272fe['id'],0x2]);}});