var a39_0x3478=['handleHurt','world','worldTime','isMoving','canMove','\x20has\x20stepped.','nextStep','checkAggro','checkHit','hasTarget','canAggro','\x20target\x20and\x20canAggro','\x20within\x20range','path','pPath','\x20path\x20same\x20as\x20before\x20and\x20expensive.','follow','setAggroRate','moveSpeed','\x20not\x20within\x20range','isInvincible','dmg','criticalHit','addTanker','getFreeAdjacentNonDiagonalPosition','underscore','./utils','./house','./formulas','extend','worldServer','map','mobsMoving','isReturning','nextGridX','nextGridY','entities','entitygrid','distanceToSpawningPoint','info','removeAttacker','clearTarget','forgetEveryone','Aggro','pushNeighbours','returnToSpawningPosition','getLastMove','target','withinAttackRange','stop','mobs','onStep','MobOnStep','onRequestPath','push','followingMode','length','slice','Move2','orientation','setFreeze','group','handleEntityGroupMembership','onStartPathing','MovePath','isAttacking','forEachBothPlayer','isDead','freeze','isAggressive','isNear','aggroRange','level','aggroPlayer','Spawn','attackingMode','handleMobHate','createAttackLink','isStunned','canAttack','mob\x20-\x20Is\x20Attacking','random','ceil','data','special','hitPoints','getCharactersAround','canCall'];(function(_0x26911f,_0x42ef24){var _0x3703e8=function(_0x2fab33){while(--_0x2fab33){_0x26911f['push'](_0x26911f['shift']());}};_0x3703e8(++_0x42ef24);}(a39_0x3478,0x121));var a39_0x1527=function(_0x42ec7f,_0x257ce8){_0x42ec7f=_0x42ec7f-0x0;var _0x5df435=a39_0x3478[_0x42ec7f];return _0x5df435;};var Messages=require('./message'),_=require(a39_0x1527('0x0')),Utils=require(a39_0x1527('0x1')),House=require(a39_0x1527('0x2')),Formulas=require(a39_0x1527('0x3'));module['exports']=MobController=Class[a39_0x1527('0x4')]({'init':function(_0x47fadf,_0x5d18c7){this['world']=this[a39_0x1527('0x5')]=_0x47fadf;this[a39_0x1527('0x6')]=_0x5d18c7;this[a39_0x1527('0x7')]=0x0;},'MobOnStep':function(_0x577dca,_0x4f1238,_0x343d29){if(!_0x577dca||_0x577dca[a39_0x1527('0x8')]||_0x577dca[a39_0x1527('0x9')]===undefined||_0x577dca[a39_0x1527('0xa')]===undefined&&_0x577dca[a39_0x1527('0x9')]<0x0||_0x577dca[a39_0x1527('0xa')]<0x0)return;this[a39_0x1527('0x6')][a39_0x1527('0xb')]['entitygrid'][_0x577dca['y']][_0x577dca['x']]=0x0;this[a39_0x1527('0x6')][a39_0x1527('0xb')][a39_0x1527('0xc')][_0x343d29][_0x4f1238]=0x1;if(_0x577dca[a39_0x1527('0xd')](_0x4f1238,_0x343d29)>=0x10&&!_0x577dca[a39_0x1527('0x8')]){log[a39_0x1527('0xe')]('Return\x20to\x20spawn!');_0x577dca['forEachAttacker'](function(_0x520add){_0x520add[a39_0x1527('0xf')](_0x577dca);});_0x577dca[a39_0x1527('0x10')]();_0x577dca[a39_0x1527('0x11')]();var _0x93834a=new Messages[(a39_0x1527('0x12'))](_0x577dca);this[a39_0x1527('0x6')][a39_0x1527('0xb')][a39_0x1527('0x13')](_0x577dca,_0x93834a);_0x577dca[a39_0x1527('0x14')]();this[a39_0x1527('0x6')][a39_0x1527('0xb')][a39_0x1527('0x13')](_0x577dca,_0x577dca[a39_0x1527('0x15')]());}if(_0x577dca[a39_0x1527('0x16')]){if(_0x577dca[a39_0x1527('0x17')](_0x577dca[a39_0x1527('0x16')])){_0x577dca[a39_0x1527('0x18')]();}}},'setEntityStep':function(){var _0x575acc=this;var _0x48e8e5=null;for(var _0x11177f in _0x575acc[a39_0x1527('0x6')][a39_0x1527('0xb')][a39_0x1527('0x19')]){_0x48e8e5=_0x575acc['map'][a39_0x1527('0xb')][a39_0x1527('0x19')][_0x11177f];_0x48e8e5[a39_0x1527('0x1a')](_0x575acc[a39_0x1527('0x1b')]);_0x48e8e5[a39_0x1527('0x1c')](function(_0x23a973,_0x3325ac){var _0x48e8e5=this;var _0x26e5fb=[_0x48e8e5];if(_0x48e8e5[a39_0x1527('0x16')])_0x26e5fb[a39_0x1527('0x1d')](_0x48e8e5[a39_0x1527('0x16')]);var _0x52465e=_0x575acc['map']['entities']['findPath'](_0x48e8e5,_0x23a973,_0x3325ac,_0x26e5fb);if(_0x52465e&&_0x52465e['length']>0x0){_0x575acc['mobsMoving']++;var _0x1a2c7c;if(_0x48e8e5[a39_0x1527('0x1e')]&&_0x52465e[a39_0x1527('0x1f')]>=0x2){_0x1a2c7c=_0x52465e[_0x52465e[a39_0x1527('0x1f')]-0x2];}else{_0x1a2c7c=_0x52465e[_0x52465e[a39_0x1527('0x1f')]-0x1];}var _0x4fe40e=_0x52465e[a39_0x1527('0x20')]();if(_0x48e8e5[a39_0x1527('0x1e')]){_0x4fe40e['pop']();}var _0x451a08;if(_0x4fe40e[a39_0x1527('0x1f')]<=0x1){_0x451a08=new Messages[(a39_0x1527('0x21'))](_0x48e8e5,_0x1a2c7c[0x0],_0x1a2c7c[0x1],_0x48e8e5[a39_0x1527('0x22')]);}else{_0x451a08=new Messages['MovePath'](_0x48e8e5,_0x4fe40e);}_0x575acc['map'][a39_0x1527('0xb')][a39_0x1527('0x13')](_0x48e8e5,_0x451a08);_0x48e8e5[a39_0x1527('0x23')](GLATENCY);return _0x52465e;}return null;});_0x48e8e5['onStopPathing'](function(_0x2fdb86,_0x336238){_0x575acc['mobsMoving']--;var _0x48e8e5=this;var _0x3f3531=_0x48e8e5[a39_0x1527('0x24')];var _0x28c66b=_0x575acc[a39_0x1527('0x6')][a39_0x1527('0xb')][a39_0x1527('0x25')](_0x48e8e5);_0x575acc['map'][a39_0x1527('0xb')][a39_0x1527('0xc')][_0x336238][_0x2fdb86]=0x1;});_0x48e8e5[a39_0x1527('0x26')](function(){var _0x48e8e5=this;});_0x48e8e5['onAbortPathing'](function(){var _0x48e8e5=this;msg=new Messages[(a39_0x1527('0x27'))](_0x48e8e5,[]);_0x575acc['map'][a39_0x1527('0xb')][a39_0x1527('0x13')](_0x48e8e5,msg);_0x48e8e5[a39_0x1527('0x23')](GLATENCY);});}_0x48e8e5=null;},'checkAggro':function(_0xd3a9e5){var _0x230eeb=this;if(_0xd3a9e5['isStunned']||_0xd3a9e5[a39_0x1527('0x28')]()||_0xd3a9e5['hasTarget']())return;_0x230eeb['map'][a39_0x1527('0xb')][a39_0x1527('0x29')](function(_0x32b214){if(_0x32b214[a39_0x1527('0x2a')]||_0x32b214[a39_0x1527('0x2b')])return;if(_0xd3a9e5[a39_0x1527('0x2c')]&&_0xd3a9e5[a39_0x1527('0x2d')](_0x32b214,_0xd3a9e5[a39_0x1527('0x2e')])&&_0xd3a9e5[a39_0x1527('0x2f')]*0x2>=_0x32b214[a39_0x1527('0x2f')]||_0xd3a9e5['isAttackedBy'](_0x32b214)){_0x230eeb[a39_0x1527('0x30')](_0xd3a9e5,_0x32b214);}});},'aggroPlayer':function(_0x14b738,_0x51d41f){var _0x41badd=this;var _0x21a171=this['worldServer'];_0x14b738[a39_0x1527('0x6')][a39_0x1527('0xb')][a39_0x1527('0x13')](_0x14b738,new Messages[(a39_0x1527('0x31'))](_0x14b738));_0x14b738['resetAggro'](0x0);_0x14b738[a39_0x1527('0x32')]=!![];_0x14b738[a39_0x1527('0x23')](GROUNDTRIP);_0x21a171[a39_0x1527('0x33')](_0x51d41f['map'],_0x14b738['id'],_0x51d41f['id'],0x5);_0x21a171[a39_0x1527('0x34')](_0x14b738,_0x51d41f);_0x21a171[a39_0x1527('0x34')](_0x51d41f,_0x14b738);},'checkHit':function(_0x2d2351){var _0x5ceac1=this;var _0xd41433=this[a39_0x1527('0x5')];if(_0x2d2351[a39_0x1527('0x35')]||!_0x2d2351[a39_0x1527('0x16')]||_0x2d2351['freeze'])return;if(_0x2d2351[a39_0x1527('0x36')]()&&_0x2d2351['withinAttackRange'](_0x2d2351['target'])){log[a39_0x1527('0xe')](a39_0x1527('0x37'));var _0x472c23=Utils[a39_0x1527('0x38')](Math[a39_0x1527('0x39')](0xc80/_0x2d2351[a39_0x1527('0x2f')]))===0x1&&(_0x2d2351[a39_0x1527('0x3a')]&&_0x2d2351[a39_0x1527('0x3a')][a39_0x1527('0x3b')]>0x0);if(_0x472c23&&_0x2d2351['level']>=0xa&&_0x2d2351['canCall']&&_0x2d2351[a39_0x1527('0x3c')]<_0x2d2351['maxHitPoints']*0.5){_0x2d2351['canCall']=![];var _0x182456=_0x5ceac1[a39_0x1527('0x6')][a39_0x1527('0xb')][a39_0x1527('0x3d')](_0x2d2351,Math['ceil'](_0x2d2351[a39_0x1527('0x2f')]/0xa)+0x1);var _0x48ed40=0x0;for(var _0x5092db in _0x182456){if(++_0x48ed40==0x3)break;if(_0x182456[_0x5092db]instanceof Mob){this[a39_0x1527('0x30')](_0x182456[_0x5092db],_0x2d2351[a39_0x1527('0x16')]);_0x182456[_0x5092db][a39_0x1527('0x3e')]=![];}}}var _0x48ab4f=Utils[a39_0x1527('0x38')](Math[a39_0x1527('0x39')](0x12c/_0x2d2351[a39_0x1527('0x2f')]))===0x1;if(_0x48ab4f&&_0x2d2351['level']>=0x19){var _0x2e6a5d=_0x5ceac1[a39_0x1527('0x6')][a39_0x1527('0xb')][a39_0x1527('0x3d')](_0x2d2351[a39_0x1527('0x16')],Math[a39_0x1527('0x39')](_0x2d2351[a39_0x1527('0x2f')]/0x5));for(var _0x5092db in _0x2e6a5d){if(_0x2e6a5d[_0x5092db]instanceof Player||_0x2e6a5d[_0x5092db]instanceof NpcPlayer)this[a39_0x1527('0x3f')](_0x2e6a5d[_0x5092db]);}}this[a39_0x1527('0x3f')](_0x2d2351);}},'checkStep':function(){var _0x19b1fb=this[a39_0x1527('0x40')][a39_0x1527('0x41')];for(var _0x836a32 in this[a39_0x1527('0x6')]['entities'][a39_0x1527('0x19')]){var _0xee7dc7=this[a39_0x1527('0x6')][a39_0x1527('0xb')][a39_0x1527('0x19')][_0x836a32];if(!_0xee7dc7||_0xee7dc7['isDead'])continue;if(_0xee7dc7[a39_0x1527('0x2b')]){return;}if(_0xee7dc7[a39_0x1527('0x42')]()&&_0xee7dc7[a39_0x1527('0x43')](_0x19b1fb)){log['info'](_0xee7dc7['id']+a39_0x1527('0x44'));_0xee7dc7[a39_0x1527('0x45')]();}}},'update':function(){for(var _0x52627d in this[a39_0x1527('0x6')]['entities'][a39_0x1527('0x19')]){var _0x4f890a=this['map']['entities'][a39_0x1527('0x19')][_0x52627d];if(_0x4f890a[a39_0x1527('0x2a')])continue;this[a39_0x1527('0x46')](_0x4f890a);this['checkChase'](_0x4f890a);this[a39_0x1527('0x47')](_0x4f890a);}},'checkChase':function(_0x197451){if(_0x197451[a39_0x1527('0x16')]&&_0x197451[a39_0x1527('0x16')][a39_0x1527('0x2a')]){_0x197451[a39_0x1527('0x10')]();return;}if(!_0x197451[a39_0x1527('0x48')]())return;if(_0x197451[a39_0x1527('0x2b')]){return;}if(_0x197451[a39_0x1527('0x49')]()){if(this['tryMovingToADifferentTile'](_0x197451)===!![]){log[a39_0x1527('0xe')](_0x197451['id']+'\x20mob\x20moving\x20to\x20different\x20tile');return;}log[a39_0x1527('0xe')](_0x197451['id']+a39_0x1527('0x4a'));if(!_0x197451['withinAttackRange'](_0x197451[a39_0x1527('0x16')])){log[a39_0x1527('0xe')](_0x197451['id']+a39_0x1527('0x4b'));if(_0x197451['isMoving']()&&_0x197451[a39_0x1527('0x4c')]==_0x197451[a39_0x1527('0x4d')]&&!_0x197451['target'][a39_0x1527('0x42')]()){log[a39_0x1527('0xe')](_0x197451['id']+a39_0x1527('0x4e'));return;}if(_0x197451[a39_0x1527('0x42')]()&&_0x197451[a39_0x1527('0x16')]['isMoving']()){log['info'](_0x197451['id']+'\x20monster\x20is\x20already\x20chasing\x20target\x20abort.');return;}log[a39_0x1527('0xe')](_0x197451['id']+'\x20EXPENSIVE\x20-\x20mob\x20following\x20target.');_0x197451[a39_0x1527('0x18')]();_0x197451[a39_0x1527('0x4f')](_0x197451[a39_0x1527('0x16')]);if(_0x197451[a39_0x1527('0x4c')]&&_0x197451[a39_0x1527('0x4c')][a39_0x1527('0x1f')]>0x2){_0x197451[a39_0x1527('0x4d')]=_0x197451[a39_0x1527('0x4c')];_0x197451[a39_0x1527('0x50')]((_0x197451[a39_0x1527('0x51')]+GLATENCY)*~~(_0x197451[a39_0x1527('0x4c')][a39_0x1527('0x1f')]/0x2));}}else{log[a39_0x1527('0xe')](_0x197451['id']+a39_0x1527('0x52'));_0x197451[a39_0x1527('0x50')](_0x197451['moveSpeed']+GLATENCY);}}},'handleHurt':function(_0x4035bf){var _0x3e82ee=this;var _0x19988d=this['worldServer'];if(!_0x4035bf[a39_0x1527('0x16')])return;if(_0x4035bf[a39_0x1527('0x16')][a39_0x1527('0x53')]){return;}if(_0x4035bf&&_0x4035bf['target'][a39_0x1527('0x3c')]>0x0&&_0x4035bf instanceof Mob||_0x4035bf instanceof House){var _0x136496;if(!Formulas['hit'](_0x4035bf,_0x4035bf[a39_0x1527('0x16')])){_0x136496=0x0;}else{_0x136496=Formulas[a39_0x1527('0x54')](_0x4035bf,_0x4035bf[a39_0x1527('0x16')]);}if(_0x4035bf[a39_0x1527('0x55')]){_0x136496*=0x2;_0x4035bf[a39_0x1527('0x55')]=![];}_0x4035bf['target']['hitPoints']-=_0x136496;if(_0x4035bf[a39_0x1527('0x16')]['hitPoints']<=0x0){_0x4035bf[a39_0x1527('0x16')][a39_0x1527('0x2a')]=!![];}_0x4035bf[a39_0x1527('0x56')](_0x4035bf[a39_0x1527('0x16')]['id']);if(_0x4035bf[a39_0x1527('0x16')]instanceof Player)_0x4035bf[a39_0x1527('0x16')]['armorDamage']+=_0x136496;_0x19988d['handleHurtEntity'](_0x4035bf[a39_0x1527('0x16')],_0x4035bf,_0x136496,_0x4035bf[a39_0x1527('0x55')]);}},'tryMovingToADifferentTile':function(_0x4bf3b5){if(_0x4bf3b5['isMoving']()||_0x4bf3b5[a39_0x1527('0x16')][a39_0x1527('0x42')]())return![];if(_0x4bf3b5[a39_0x1527('0x16')]&&_0x4bf3b5!==_0x4bf3b5[a39_0x1527('0x16')]&&_0x4bf3b5['x']==_0x4bf3b5['target']['x']&&_0x4bf3b5['y']==_0x4bf3b5['target']['y']){log[a39_0x1527('0xe')]('tryMovingToADifferentTile\x20-\x20entity\x20on\x20target');var _0x2267d5=_0x4bf3b5[a39_0x1527('0x6')][a39_0x1527('0xb')][a39_0x1527('0x57')](_0x4bf3b5[a39_0x1527('0x16')]);if(_0x2267d5){_0x4bf3b5['go'](_0x2267d5['x'],_0x2267d5['y']);return!![];}}return![];}});