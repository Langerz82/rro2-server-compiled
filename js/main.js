var a30_0x4a67=['debug','info','DEBUG','ERROR','inProduction','extend','getProductionSettings','world_id','email','verify_email','key','verify_key','./ws','port','use_one_port','Initializing\x20TTA\x20GameServer\x20-\x20World\x20','version\x20sent','sendUTF8','version','newConnection','enterWorld','onError','join','each','range','nb_worlds','world','run','world_collision.json','push','stringify','uncaughtException:\x20','stack','connection','log','connected','disconnect','disconnected','msg','msg=','parse','text','MSG_BUYPRODUCT','verifyINAPP','isSuccessful','emit','MSG_ERRORPRODUCT','errorMessage','then','productId','gold100000','gold1000000\x20added\x20to\x20player.','payload','catch','playerCount','utf8','./config.json','./config_local.json','argv','Server\x20cannot\x20start\x20without\x20any\x20configuration\x20file.','exit','./metrics','./productionconfig','underscore','express','http','createServer','socket.io','com.retrorpgonline2','error'];(function(_0x5a3c02,_0x26c6aa){var _0xe85689=function(_0x45a6de){while(--_0x45a6de){_0x5a3c02['push'](_0x5a3c02['shift']());}};_0xe85689(++_0x26c6aa);}(a30_0x4a67,0x10f));var a30_0x314c=function(_0x3db91e,_0x4e5e5d){_0x3db91e=_0x3db91e-0x0;var _0x50c4e8=a30_0x4a67[_0x3db91e];return _0x50c4e8;};var fs=require('fs');var Metrics=require(a30_0x314c('0x0'));var ProductionConfig=require(a30_0x314c('0x1'));var _=require(a30_0x314c('0x2'));let app=require(a30_0x314c('0x3'))();let storeserver=require(a30_0x314c('0x4'))[a30_0x314c('0x5')](app);let io=require(a30_0x314c('0x6'))(storeserver);let Verifier=require('google-play-billing-validator');var verifyOptions={'email':'','key':''};let packageName=a30_0x314c('0x7');let verifier=null;let IO_STATES={'MSG_BUYPRODUCT':0x1,'MSG_ERRORPRODUCT':0x2};GLATENCY=0xc8;GROUNDTRIP=GLATENCY*0x2;function main(_0x21114f){var _0x20d3e3=require('log');switch(_0x21114f['debug_level']){case a30_0x314c('0x8'):case a30_0x314c('0x9'):case a30_0x314c('0xa'):log=new _0x20d3e3(_0x20d3e3['INFO']||_0x20d3e3[a30_0x314c('0xb')]||_0x20d3e3[a30_0x314c('0xc')]);break;}var _0x4b4c7f=new ProductionConfig(_0x21114f);if(_0x4b4c7f[a30_0x314c('0xd')]()){_[a30_0x314c('0xe')](_0x21114f,_0x4b4c7f[a30_0x314c('0xf')]());}var _0x201796=_0x21114f[a30_0x314c('0x10')];verifyOptions[a30_0x314c('0x11')]=_0x21114f[a30_0x314c('0x12')];verifyOptions[a30_0x314c('0x13')]=_0x21114f[a30_0x314c('0x14')];verifier=new Verifier(verifyOptions);var _0x2049ff=require(a30_0x314c('0x15'));var _0x5ecf9e=require('./worldserver');var _0x10f055=new _0x2049ff['WebsocketServer'](_0x21114f[a30_0x314c('0x16')],_0x21114f[a30_0x314c('0x17')],_0x21114f['ip']);var _0x6339c4=_0x21114f['metrics_enabled']?new Metrics(_0x21114f):null;var _0x849049=[];var _0x4a6832=0x0;var _0x3f690a=require('./databaseselector');log[a30_0x314c('0xa')](a30_0x314c('0x18')+_0x201796);var _0x4b9376=_0x3f690a(_0x21114f);databaseHandler=new _0x4b9376(_0x21114f);_0x10f055['onConnect'](function(_0x585c76){var _0x5f56ff=this;var _0x4bad7c=function(_0x21114f){log['info'](JSON['stringify'](_0x21114f));log[a30_0x314c('0xa')](a30_0x314c('0x19'));_0x585c76[a30_0x314c('0x1a')](a30_0x314c('0x1b')+_0x21114f[a30_0x314c('0x1b')]);_0x5f56ff[a30_0x314c('0x1c')]=_0x585c76;};_0x4bad7c(_0x21114f);});_0x10f055[a30_0x314c('0x1d')]=function(_0x2c085c,_0xdf9d0b){var _0x3053f3=_0x849049[0x0];if(_0x2c085c=='world'){if(_0x3053f3){var _0x280eda=new Player(_0x10f055[a30_0x314c('0x1c')],_0x3053f3,databaseHandler);_0x3053f3['connect_callback'](_0x280eda);}}};_0x10f055[a30_0x314c('0x1e')](function(){log[a30_0x314c('0x8')](Array['prototype'][a30_0x314c('0x1f')]['call'](arguments,',\x20'));});_[a30_0x314c('0x20')](_[a30_0x314c('0x21')](_0x21114f[a30_0x314c('0x22')]),function(_0x3b4034){var _0x15cb1a=new _0x5ecf9e(a30_0x314c('0x23')+_0x3b4034,_0x21114f['nb_players_per_world'],_0x10f055,databaseHandler);log[a30_0x314c('0xa')]('config.map_filepath:'+_0x21114f['map_filepath']);_0x15cb1a[a30_0x314c('0x24')](_0x21114f['map_filepath'],a30_0x314c('0x25'));_0x849049[a30_0x314c('0x26')](_0x15cb1a);});_0x10f055['onRequestStatus'](function(){return JSON[a30_0x314c('0x27')](getWorldDistribution(_0x849049));});process['on']('uncaughtException',function(_0x5c8da9){log[a30_0x314c('0x8')](a30_0x314c('0x28')+_0x5c8da9[a30_0x314c('0x29')]);});io['on'](a30_0x314c('0x2a'),_0x1244f4=>{console[a30_0x314c('0x2b')](a30_0x314c('0x2c'));_0x1244f4['on'](a30_0x314c('0x2d'),function(){console['log'](a30_0x314c('0x2e'));});_0x1244f4['on'](a30_0x314c('0x2f'),_0x39a11a=>{console['log'](a30_0x314c('0x30')+JSON[a30_0x314c('0x27')](_0x39a11a));let _0x5c5fd3=JSON[a30_0x314c('0x31')](_0x39a11a[a30_0x314c('0x32')]);if(_0x5c5fd3[0x0]==IO_STATES[a30_0x314c('0x33')]){let _0x46b8b9=_0x5c5fd3[0x1];let _0x28ae02={'packageName':packageName,'productId':_0x5c5fd3[0x2],'purchaseToken':_0x5c5fd3[0x3]};let _0x1df508=verifier[a30_0x314c('0x34')](_0x28ae02);_0x1df508['then'](function(_0x34b8ba){if(!_0x34b8ba[a30_0x314c('0x35')])io[a30_0x314c('0x36')](a30_0x314c('0x2f'),JSON['stringify']([IO_STATES[a30_0x314c('0x37')],_0x34b8ba[a30_0x314c('0x38')]]));})[a30_0x314c('0x39')](function(_0xf59954){if(_0xf59954['isSuccessful']){if(_0xf59954[a30_0x314c('0x3a')]===a30_0x314c('0x3b')){console['log']('gold100000\x20added\x20to\x20player.');}if(_0xf59954[a30_0x314c('0x3a')]==='gold1000000'){console['log'](a30_0x314c('0x3c'));}console[a30_0x314c('0x2b')](JSON[a30_0x314c('0x27')](_0xf59954));io[a30_0x314c('0x36')](a30_0x314c('0x2f'),JSON['stringify']([IO_STATES[a30_0x314c('0x37')],_0xf59954[a30_0x314c('0x3d')]['message']]));}else{io[a30_0x314c('0x36')](a30_0x314c('0x2f'),JSON[a30_0x314c('0x27')]([IO_STATES[a30_0x314c('0x37')],_0xf59954[a30_0x314c('0x38')]]));}})[a30_0x314c('0x3e')](function(_0x29da55){io[a30_0x314c('0x36')](a30_0x314c('0x2f'),JSON['stringify']([IO_STATES[a30_0x314c('0x37')],_0x29da55[a30_0x314c('0x38')]]));});}});});let _0x56f9b2=0xbb9;storeserver['listen'](_0x56f9b2,function(){console[a30_0x314c('0x2b')]('listening\x20in\x20http://localhost:'+_0x56f9b2);});}function getWorldDistribution(_0x25cc97){var _0x3b1eeb=[];_[a30_0x314c('0x20')](_0x25cc97,function(_0x5221f0){_0x3b1eeb['push'](_0x5221f0[a30_0x314c('0x3f')]);});return _0x3b1eeb;}function getConfigFile(_0x47c93a,_0x2d0365){fs['readFile'](_0x47c93a,a30_0x314c('0x40'),function(_0x4b6fc5,_0x86097c){if(_0x4b6fc5){_0x2d0365(null);}else{_0x2d0365(JSON[a30_0x314c('0x31')](_0x86097c));}});}var defaultConfigPath=a30_0x314c('0x41');var customConfigPath=a30_0x314c('0x42');process[a30_0x314c('0x43')]['forEach'](function(_0x5f1561,_0x4c0e9e,_0x7ea79b){if(_0x4c0e9e===0x2){customConfigPath=_0x5f1561;}});getConfigFile(defaultConfigPath,function(_0x25a2dc){getConfigFile(customConfigPath,function(_0x323798){if(_0x323798){main(_0x323798);}else if(_0x25a2dc){main(_0x25a2dc);}else{console[a30_0x314c('0x8')](a30_0x314c('0x44'));process[a30_0x314c('0x45')](0x1);}});});