var a31_0x54b4=['floor','grid','isOutOfBounds','split','GroupIdToGroupPosition','each','connectedGroups','any','reject','getAdjacentGroupPositions','getGroupIdFromPosition','push','startingAreas','randomInt','getRandomPosition','getRandomStartingPosition\x20-\x20none','isNumber','isColliding','isValidPosition','warn','getRandomPosition()-tries=','stringify','door.tmap=','tmap','minLevel','tminLevel','maxLevel','tmaxLevel','portal','admin','orientation','Orientations','DOWN','LEFT','RIGHT','return\x20doors','detect','contains','exports','underscore','../shared/js/file','path','./utils','./checkpoint','./maparea','Class','extend','info','name','isLoaded','index','exists','parse','initMap','width','height','this.height=','collisions','roamingAreas','chestAreas','staticChests','staticEntities','generateCollisions','this.mobAreas:\x20','zoneWidth','zoneHeight','groupWidth','groupHeight','ceil','initConnectedGroups','doors','loadCollisionGrid','collision','initCheckpoints','checkpoints','readyFunc'];(function(_0x323e55,_0x184723){var _0x1ef46b=function(_0x1b08bc){while(--_0x1b08bc){_0x323e55['push'](_0x323e55['shift']());}};_0x1ef46b(++_0x184723);}(a31_0x54b4,0x1a3));var a31_0x3e41=function(_0x1c16f7,_0x19415f){_0x1c16f7=_0x1c16f7-0x0;var _0x485c2b=a31_0x54b4[_0x1c16f7];return _0x485c2b;};var cls=require('./lib/class');_=require(a31_0x3e41('0x0'));var fs=require('fs');var file=require(a31_0x3e41('0x1'));var path=require(a31_0x3e41('0x2'));var Utils=require(a31_0x3e41('0x3'));var Checkpoint=require(a31_0x3e41('0x4'));var Area=require('./area');var MapArea=require(a31_0x3e41('0x5'));var Map=cls[a31_0x3e41('0x6')][a31_0x3e41('0x7')]({'init':function(_0xef9ccc,_0x2f81fe,_0x4bcc0b,_0x105661,_0x5c41fb){this['id']=_0xef9ccc;log[a31_0x3e41('0x8')]('filepath:\x20'+_0x105661+',filenameCollision:\x20'+_0x5c41fb);var _0x3d19b4=this;this[a31_0x3e41('0x9')]=_0x4bcc0b;this[a31_0x3e41('0xa')]=![];this[a31_0x3e41('0xb')]=_0x2f81fe;var _0x5c41fb=_0x5c41fb;file[a31_0x3e41('0xc')](_0x105661,function(_0x5cc4e8){if(!_0x5cc4e8){log['error'](_0x105661+'\x20doesn\x27t\x20exist.');return;}fs['readFile'](_0x105661,function(_0x171a7a,_0x498274){var _0x5cbebe=JSON[a31_0x3e41('0xd')](_0x498274);_0x3d19b4[a31_0x3e41('0xe')](_0x5cbebe,_0x5c41fb);});});},'initMap':function(_0x5bd86d,_0x3853f6){this[a31_0x3e41('0xf')]=_0x5bd86d[a31_0x3e41('0xf')];this[a31_0x3e41('0x10')]=_0x5bd86d[a31_0x3e41('0x10')];log[a31_0x3e41('0x8')]('this.width='+this['width']);log['info'](a31_0x3e41('0x11')+this[a31_0x3e41('0x10')]);this[a31_0x3e41('0x12')]=_0x5bd86d['collisions'];this['mobAreas']=_0x5bd86d[a31_0x3e41('0x13')];this[a31_0x3e41('0x14')]=_0x5bd86d[a31_0x3e41('0x14')];this['staticChests']=_0x5bd86d[a31_0x3e41('0x15')];this[a31_0x3e41('0x16')]=_0x5bd86d[a31_0x3e41('0x16')];this[a31_0x3e41('0x17')]=!![];log[a31_0x3e41('0x8')](a31_0x3e41('0x18')+this['mobAreas']['length']);this[a31_0x3e41('0x19')]=0x20;this[a31_0x3e41('0x1a')]=0x20;this[a31_0x3e41('0x1b')]=Math['ceil'](this[a31_0x3e41('0xf')]/this[a31_0x3e41('0x19')]);this[a31_0x3e41('0x1c')]=Math[a31_0x3e41('0x1d')](this[a31_0x3e41('0x10')]/this['zoneHeight']);this[a31_0x3e41('0x1e')](_0x5bd86d[a31_0x3e41('0x1f')]);this[a31_0x3e41('0x20')](_0x5bd86d[a31_0x3e41('0x21')]);this[a31_0x3e41('0x22')](_0x5bd86d[a31_0x3e41('0x23')]);this[a31_0x3e41('0x1f')]=this['_getDoors'](_0x5bd86d);this[a31_0x3e41('0xa')]=!![];},'ready':function(_0x4b1935){this[a31_0x3e41('0x24')]=_0x4b1935;},'tileIndexToGridPosition':function(_0x17f80c){var _0x4ef0de=0x0;var _0x126dbd=0x0;var _0x2610a7=function(_0x43c3e3,_0x4f5ac1){if(_0x43c3e3===0x0){return 0x0;}return _0x43c3e3%_0x4f5ac1===0x0?_0x4f5ac1-0x1:_0x43c3e3%_0x4f5ac1-0x1;};_0x17f80c-=0x1;_0x4ef0de=_0x2610a7(_0x17f80c+0x1,this['width']);_0x126dbd=Math[a31_0x3e41('0x25')](_0x17f80c/this['width']);return{'x':_0x4ef0de,'y':_0x126dbd};},'GridPositionToTileIndex':function(_0x1fd294,_0x28a450){return _0x28a450*this['width']+_0x1fd294+0x1;},'loadCollisionGrid':function(_0x3409b0){var _0x4547f0=this;_0x4547f0[a31_0x3e41('0x26')]=[];for(var _0x2bc608=0x0;_0x2bc608<_0x4547f0[a31_0x3e41('0x10')];_0x2bc608++){_0x4547f0['grid'][_0x2bc608]=[];for(var _0x1483c6=0x0;_0x1483c6<_0x4547f0[a31_0x3e41('0xf')];_0x1483c6++){_0x4547f0['grid'][_0x2bc608][_0x1483c6]=_0x3409b0[_0x2bc608*_0x4547f0[a31_0x3e41('0x10')]+_0x1483c6];}}_0x4547f0[a31_0x3e41('0x24')]();log['info']('Collision\x20Grid\x20Loaded');},'isOutOfBounds':function(_0x503e2d,_0x338f27,_0x52509f,_0x3b79e9){if(_0x52509f&&_0x3b79e9)return _0x503e2d<=0x0||_0x503e2d>=this[a31_0x3e41('0xf')]||_0x338f27<=0x0||_0x338f27>=this[a31_0x3e41('0x10')]||(_0x52509f>=this[a31_0x3e41('0xf')]||_0x3b79e9>=this[a31_0x3e41('0x10')]);else return _0x503e2d<=0x0||_0x503e2d>=this['width']||_0x338f27<=0x0||_0x338f27>=this[a31_0x3e41('0x10')];},'isColliding':function(_0x5d6600,_0x5e66b6,_0x5bbd14,_0x4f99a5){if(this[a31_0x3e41('0x27')](_0x5d6600,_0x5e66b6)){return![];}if(_0x5bbd14&&_0x4f99a5){return this[a31_0x3e41('0x26')][_0x5e66b6][_0x5d6600]===0x1||this[a31_0x3e41('0x26')][_0x4f99a5][_0x5bbd14]===0x1||this[a31_0x3e41('0x26')][_0x4f99a5][_0x5d6600]===0x1||this[a31_0x3e41('0x26')][_0x5e66b6][_0x5bbd14]===0x1;}else return this[a31_0x3e41('0x26')][_0x5e66b6][_0x5d6600]===0x1;},'GroupIdToGroupPosition':function(_0x18ae28){var _0x5e9d1b=_0x18ae28[a31_0x3e41('0x28')]('-');return pos(parseInt(_0x5e9d1b[0x0],0xa),parseInt(_0x5e9d1b[0x1],0xa));},'forEachGroup':function(_0x296e90){var _0x5a68af=this[a31_0x3e41('0x1b')];var _0x2033f6=this[a31_0x3e41('0x1c')];for(var _0x5b65be=0x0;_0x5b65be<_0x5a68af;_0x5b65be+=0x1){for(var _0x5a6601=0x0;_0x5a6601<_0x2033f6;_0x5a6601+=0x1){_0x296e90(_0x5b65be+'-'+_0x5a6601);}}},'getGroupIdFromPosition':function(_0x1d5672,_0x4847f0){var _0x18018d=this[a31_0x3e41('0x19')];var _0x3562e4=this[a31_0x3e41('0x1a')];var _0xf559f0=Math[a31_0x3e41('0x25')](_0x1d5672/_0x18018d);var _0x3654ea=Math['floor'](_0x4847f0/_0x3562e4);return _0xf559f0+'-'+_0x3654ea;},'getAdjacentGroupPositions':function(_0x99be8d){var _0x382ff7=this;var _0x203db6=this[a31_0x3e41('0x29')](_0x99be8d);var _0x3484d7=_0x203db6['x'];var _0x49f3e2=_0x203db6['y'];var _0x1aab0f=[pos(_0x3484d7-0x1,_0x49f3e2-0x1),pos(_0x3484d7,_0x49f3e2-0x1),pos(_0x3484d7+0x1,_0x49f3e2-0x1),pos(_0x3484d7-0x1,_0x49f3e2),pos(_0x3484d7,_0x49f3e2),pos(_0x3484d7+0x1,_0x49f3e2),pos(_0x3484d7-0x1,_0x49f3e2+0x1),pos(_0x3484d7,_0x49f3e2+0x1),pos(_0x3484d7+0x1,_0x49f3e2+0x1)];_[a31_0x3e41('0x2a')](this[a31_0x3e41('0x2b')][_0x99be8d],function(_0x203db6){if(!_[a31_0x3e41('0x2c')](_0x1aab0f,function(_0x14d013){return equalPositions(_0x14d013,_0x203db6);})){_0x1aab0f['push'](_0x203db6);}});return _[a31_0x3e41('0x2d')](_0x1aab0f,function(_0x4663b0){return _0x4663b0['x']<0x0||_0x4663b0['y']<0x0||_0x4663b0['x']>=_0x382ff7[a31_0x3e41('0x1b')]||_0x4663b0['y']>=_0x382ff7[a31_0x3e41('0x1c')];});},'forEachAdjacentGroup':function(_0x3537fc,_0x557a52){if(_0x3537fc){_[a31_0x3e41('0x2a')](this[a31_0x3e41('0x2e')](_0x3537fc),function(_0x56603d){_0x557a52(_0x56603d['x']+'-'+_0x56603d['y']);});}},'initConnectedGroups':function(_0x12f02d){var _0x478bdd=this;this['connectedGroups']={};_[a31_0x3e41('0x2a')](_0x12f02d,function(_0x31deed){var _0x49c1cb=_0x478bdd[a31_0x3e41('0x2f')](_0x31deed['x'],_0x31deed['y']);var _0x57802b=_0x478bdd[a31_0x3e41('0x2f')](_0x31deed['tx'],_0x31deed['ty']);var _0x203f3e=_0x478bdd['GroupIdToGroupPosition'](_0x57802b);if(_0x49c1cb in _0x478bdd['connectedGroups']){_0x478bdd[a31_0x3e41('0x2b')][_0x49c1cb][a31_0x3e41('0x30')](_0x203f3e);}else{_0x478bdd[a31_0x3e41('0x2b')][_0x49c1cb]=[_0x203f3e];}});},'initCheckpoints':function(_0x445f97){var _0x5077e0=this;this[a31_0x3e41('0x23')]={};this[a31_0x3e41('0x31')]=[];_[a31_0x3e41('0x2a')](_0x445f97,function(_0x3d10ce){var _0x271dd4=new Checkpoint(_0x5077e0,_0x3d10ce['id'],_0x3d10ce['x'],_0x3d10ce['y'],_0x3d10ce['w'],_0x3d10ce['h']);_0x5077e0[a31_0x3e41('0x23')][_0x271dd4['id']]=_0x271dd4;if(_0x3d10ce['s']===0x1){_0x5077e0[a31_0x3e41('0x31')][a31_0x3e41('0x30')](_0x271dd4);}});},'getCheckpoint':function(_0x1342fd){return this[a31_0x3e41('0x23')][_0x1342fd];},'getRandomStartingPosition':function(_0x4a1c48){var _0x59eba7=_['size'](this['startingAreas']);var _0x5302de=Utils[a31_0x3e41('0x32')](0x0,_0x59eba7-0x1);if(!_0x4a1c48)_0x4a1c48=this[a31_0x3e41('0x31')][_0x5302de];if(_0x4a1c48)return _0x4a1c48[a31_0x3e41('0x33')]();else{log[a31_0x3e41('0x8')](a31_0x3e41('0x34'));return null;}},'isValidPosition':function(_0x797f25,_0x3aad5f,_0x4969e3,_0x310a64){var _0xb364dd=this;return _[a31_0x3e41('0x35')](_0x797f25)&&_['isNumber'](_0x3aad5f)&&!_0xb364dd[a31_0x3e41('0x27')](_0x797f25,_0x3aad5f,_0x4969e3,_0x310a64)&&!_0xb364dd[a31_0x3e41('0x36')](_0x797f25,_0x3aad5f,_0x4969e3,_0x310a64);},'getRandomPosition':function(_0x26fd5d){var _0x230e5c=this;var _0x13fc3a={};_0x13fc3a['x']=Utils[a31_0x3e41('0x32')](0x0,_0x230e5c[a31_0x3e41('0xf')]-0x1);_0x13fc3a['y']=Utils[a31_0x3e41('0x32')](0x0,_0x230e5c[a31_0x3e41('0x10')]-0x1);var _0x425cbe=0x0;while(!_0x230e5c[a31_0x3e41('0x37')](_0x13fc3a['x'],_0x13fc3a['y'])||_0x26fd5d&&!_0x230e5c[a31_0x3e41('0x37')](_0x13fc3a['x']+_0x26fd5d[0x0],_0x13fc3a['y']+_0x26fd5d[0x1],_0x13fc3a['x']+_0x26fd5d[0x2],_0x13fc3a['y']+_0x26fd5d[0x3])&&_0x425cbe<0x19){++_0x425cbe;_0x13fc3a['x']=Utils[a31_0x3e41('0x32')](0x0-_0x26fd5d[0x0],_0x230e5c[a31_0x3e41('0xf')]-0x1-_0x26fd5d[0x2]);_0x13fc3a['y']=Utils[a31_0x3e41('0x32')](0x0-_0x26fd5d[0x1],_0x230e5c[a31_0x3e41('0x10')]-0x1-_0x26fd5d[0x3]);}if(_0x425cbe>=0x19){_0x13fc3a['x']=-0x1;_0x13fc3a['y']=-0x1;log[a31_0x3e41('0x38')](a31_0x3e41('0x39')+_0x425cbe);}return _0x13fc3a;},'_getDoors':function(_0x13ef40){var _0x12159d=this;log[a31_0x3e41('0x8')](JSON[a31_0x3e41('0x3a')](_0x13ef40['doors']));var _0x379bf1=[];_[a31_0x3e41('0x2a')](_0x13ef40[a31_0x3e41('0x1f')],function(_0x1b6a76){_0x1b6a76['width']=_0x1b6a76['width']?_0x1b6a76['width']:0x1;_0x1b6a76[a31_0x3e41('0x10')]=_0x1b6a76[a31_0x3e41('0x10')]?_0x1b6a76[a31_0x3e41('0x10')]:0x1;log[a31_0x3e41('0x8')](a31_0x3e41('0x3b')+_0x1b6a76[a31_0x3e41('0x3c')]);var _0x29c9c0=new MapArea(_0x13ef40,![],_0x1b6a76['x'],_0x1b6a76['y'],_0x1b6a76[a31_0x3e41('0xf')],_0x1b6a76[a31_0x3e41('0x10')],-0x1);_0x29c9c0[a31_0x3e41('0x3d')]=_0x1b6a76[a31_0x3e41('0x3e')]||0x0,_0x29c9c0[a31_0x3e41('0x3f')]=_0x1b6a76[a31_0x3e41('0x40')]||0xc8,_0x29c9c0['map']=_0x1b6a76[a31_0x3e41('0x3c')]?_0x1b6a76[a31_0x3e41('0x3c')]:0x1,_0x29c9c0[a31_0x3e41('0x41')]=_0x1b6a76['p']===0x1,_0x29c9c0['quest']=_0x1b6a76['tq'],_0x29c9c0[a31_0x3e41('0x42')]=_0x1b6a76['a'];switch(_0x1b6a76['to']){case'u':_0x29c9c0[a31_0x3e41('0x43')]=Types[a31_0x3e41('0x44')]['UP'];break;case'd':_0x29c9c0[a31_0x3e41('0x43')]=Types[a31_0x3e41('0x44')][a31_0x3e41('0x45')];break;case'l':_0x29c9c0[a31_0x3e41('0x43')]=Types[a31_0x3e41('0x44')][a31_0x3e41('0x46')];break;case'r':_0x29c9c0[a31_0x3e41('0x43')]=Types[a31_0x3e41('0x44')][a31_0x3e41('0x47')];break;default:_0x29c9c0['orientation']=Types[a31_0x3e41('0x44')][a31_0x3e41('0x45')];}_0x379bf1['push'](_0x29c9c0);});log[a31_0x3e41('0x8')](a31_0x3e41('0x48'));return _0x379bf1;},'isDoor':function(_0x6339d1,_0x4d8084){return _[a31_0x3e41('0x49')](this[a31_0x3e41('0x1f')],function(_0x4c1b44){return _0x4c1b44[a31_0x3e41('0x4a')]({'x':_0x6339d1,'y':_0x4d8084})!=null;});},'getDoor':function(_0x3e0641){return _['detect'](this['doors'],function(_0x17ccc2){return _0x17ccc2[a31_0x3e41('0x4a')](_0x3e0641);});}});var pos=function(_0x33ba09,_0x2b7350){return{'x':_0x33ba09,'y':_0x2b7350};};var equalPositions=function(_0x5323a2,_0x4f5dd5){return _0x5323a2['x']===_0x4f5dd5['x']&&_0x4f5dd5['y']===_0x4f5dd5['y'];};module[a31_0x3e41('0x4b')]=Map;